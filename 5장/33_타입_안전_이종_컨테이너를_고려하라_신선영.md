# item33. íƒ€ì… ì•ˆì „ ì´ì¢… ì»¨í…Œì´ë„ˆë¥¼ ê³ ë ¤í•˜ë¼

# ğŸ§ íƒ€ì… ì•ˆì „ ì´ì¢… ì»¨í…Œì´ë„ˆ

## ì •ì˜

ì˜ì–´ë¡œ í’€ì–´ì“°ë©´ **type safe heterogeneous container**

type safeëŠ” ì•Œê² ëŠ”ë° ...  ****heterogeneous containerê°€ ë¬´ìŠ¨ ëœ»ì¸ì§€ ëª¨ë¥´ê² ë‹¤... ğŸ¤”

### heterogeneous

![image](https://user-images.githubusercontent.com/42836576/107503317-26eddf80-6bdd-11eb-9e5b-20379156139b.png)

### container

ê°’ì„ ì €ì¥í•  ìˆ˜ ìˆëŠ” ê°ì²´ (ex. Map, Set)

ì¦‰, íƒ€ì… ì•ˆì „ ì´ì¢… ì»¨í…Œì´ë„ˆë€

**ì—¬ëŸ¬ ë‹¤ë¥¸ ì¢…ë¥˜**ë“¤ë¡œ ì´ë£¨ì–´ì§„ **ê°’ì„ ì €ì¥í•˜ëŠ”** **íƒ€ì…ì— ì•ˆì „í•œ ê°ì²´**ë¥¼ ëœ»í•œë‹¤.

## ì‚¬ìš©í•˜ëŠ” ì´ìœ 

- í•™ë²ˆì„ ì €ì¥í•˜ëŠ” `Set<Integer>`
    - `Integer`í˜•ì˜ ê°’ë§Œ ì €ì¥í•  ìˆ˜ ìˆë‹¤.
- ì´ë¦„ê³¼ ë‚˜ì´ë¥¼ ì €ì¥í•˜ëŠ” `Map<String, Integer>`
    - `String`í˜•ì˜ keyì™€ `Integer`í˜•ì˜ valueë§Œ ì €ì¥í•  ìˆ˜ ìˆë‹¤.
- ë°ì´í„°ë² ì´ìŠ¤ì˜ íƒ€ì… ì¢…ë¥˜ë¥¼ ì €ì¥í•˜ëŠ” Set
    - íƒ€ì…ì´ `String`ì¼ ìˆ˜ë„, `Integer`ì¼ ìˆ˜ë„ ìˆë‹¤.
    - ì–´ë–»ê²Œ ì €ì¥í•˜ì§€?
    - ì´ë•Œ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ **íƒ€ì… ì•ˆì „ ì´ì¢… ì»¨í…Œì´ë„ˆ**

## ì˜ˆì œ ì½”ë“œ

```java
public class Favorites {
  private Map<Class<?>, Object> favorites = new HashMap<>();

  public <T> void putFavorite(Class<T> type, T instance) {
    favorites.put(Objects.requireNonNull(type), instance);
  }

  public <T> T getFavorite(Class<T> type) {
    return type.cast(favorites.get(type));
  }
  
  @Test
  public void íƒ€ì…_ì•ˆì „_ì´ì¢…_ì»¨í…Œì´ë„ˆ_íŒ¨í„´() {
    // given
    Favorites f = new Favorites();
    
    String testString = "Effective Java";
    Integer testInteger = 1;
    Class testClass = Favorites.class;
    

    // when
    f.putFavorite(String.class, testString);
    f.putFavorite(Integer.class, testInteger);
    f.putFavorite(Class.class, testClass);
    
    // then
    Assert.assertEquals(f.getFavorite(String.class), testString);
    Assert.assertEquals(f.getFavorite(Integer.class), testInteger);
    Assert.assertEquals(f.getFavorite(Class.class), testClass);
  }

}
```

![image](https://user-images.githubusercontent.com/42836576/107503324-29503980-6bdd-11eb-8c07-8617cac40946.png)

![image](https://user-images.githubusercontent.com/42836576/107503331-2bb29380-6bdd-11eb-8cda-fde79417f1b0.png)

ì±…ì—ì„œ ì†Œê°œí•´ì£¼ëŠ” ì•Œì•„ë‘ë©´ (ì•„ë§ˆ) ì¢‹ì€ ìƒì‹

ì¤„ ë„ì›€ì„ í•  ë•Œ, Cì—ì„œëŠ” `\n`ì„ ì‚¬ìš©í•˜ê³ , ìë°”ì—ì„œëŠ” `%n`ë¥¼ ì‚¬ìš©í•œë‹¤.
ìë°”ì—ì„œëŠ” `%n`ë¥¼ ì§€ì›í•˜ëŠ”ë°, `%n`ì€ í”Œë«í¼ì— ë§ëŠ” ì¤„ë°”ê¿ˆ ë¬¸ìë¡œ ìë™ìœ¼ë¡œ ëŒ€ì²´ëœë‹¤. 
(ëŒ€ë¶€ë¶„ \nì´ ë˜ê² ì§€ë§Œ, ëª¨ë“  í”Œë«í¼ì´ ê·¸ë ‡ì§€ëŠ” ì•Šë‹¤.)

### ì˜ˆì œì½”ë“œ í†ºì•„ë³´ê¸°

```java
private Map<Class<?>, Object> favorites = new HashMap<>();
```

- key íƒ€ì…ì´ `Class<T>`ì´ê¸° ë•Œë¬¸ì—, **ì—¬ëŸ¬ íƒ€ì…ì˜ key**ë¥¼ ë‹´ì„ ìˆ˜ ìˆë‹¤.
- ğŸ¤” value íƒ€ì…ì´ `Object`ì¸ë° í‚¤ì™€ ë°˜ë“œì‹œ ê°™ë‹¤ê³  ë³´ì¥í•  ìˆ˜ ì—†ì§€ ì•Šì„ê¹Œ?
    - ë³´ì¥í•  ìˆ˜ ì—†ë‹¤. í•˜ì§€ë§Œ ìš°ë¦¬ëŠ” ì´ ê´€ê³„ê°€ ì„±ë¦½í•¨ì„ ì•Œ ìˆ˜ ìˆë‹¤.

```java
public <T> void putFavorite(Class<T> type, T instance) {
    favorites.put(Objects.requireNonNull(type), instance);
  }
```

- Mapì— ë„£ëŠ”ë‹¤. ì´ ë•Œ, (ë‹¹ì—°í•˜ì§€ë§Œ) typeì€ nullì´ ë“¤ì–´ê°€ë©´ ì•ˆëœë‹¤.

```java
public <T> T getFavorite(Class<T> type) {
    return type.cast(favorites.get(type));
  }
```

- `cast()`
    - ë¥¼ í•˜ì§€ ì•Šìœ¼ë©´, `T`ê°€ ì•„ë‹Œ `Object`ê°€ ë°˜í™˜ëœë‹¤. (Mapì˜ value íƒ€ì…ì´ `Object`ì´ê¸° ë•Œë¬¸ì—!)
    - ì£¼ì–´ì§„ ì¸ìˆ˜ê°€ Class ê°ì²´ê°€ ì•Œë ¤ì£¼ëŠ” íƒ€ì…ì˜ ì¸ìŠ¤í„´ìŠ¤ì¸ì§€ë¥¼ ê²€ì‚¬í•œ ë‹¤ìŒ, ë§ë‹¤ë©´ ê·¸ëŒ€ë¡œ ìºìŠ¤íŒ…í•´ì£¼ê³ , ì•„ë‹ˆë©´ `ClassCastException`ì„ ë˜ì§„ë‹¤.

    ```java
    public final class Class<T>  {
    	public T cast(Object obj) {
    	        if (obj != null && !isInstance(obj))
    	            throw new ClassCastException(cannotCastMsg(obj));
    	        return (T) obj;
    	    }
    }
    ```

    - type-safeí•˜ë‹¤.

## ì œì•½

ì´ë ‡ê²Œ ì¢‹ì•„ë³´ì´ëŠ” íƒ€ì… ì•ˆì „ ì´ì¢… ì»¨í…Œì´ë„ˆì—ë„ ì œì•½ì´ ìˆë‹¤!

1. ì•…ì˜ì ì¸ í´ë¼ì´ì–¸íŠ¸ê°€ Class ê°ì²´ë¥¼ ë¡œ íƒ€ì…(raw type)ìœ¼ë¡œ ë„˜ê¸°ë©´ íƒ€ì… ì•ˆì •ì„±ì´ ì‰½ê²Œ ê¹¨ì§„ë‹¤.

```java
@Test(expected = ClassCastException.class)
  public void ë¡œ_íƒ€ì…_ì‚¬ìš©_ì‹œ_ì˜ˆì™¸_ë¹Œìƒ() {
    // given
    Favorites f = new Favorites();

    String testString = "Effective Java";

    // when
    f.putFavorite((Class)Integer.class, testString);
  }
```

![image](https://user-images.githubusercontent.com/42836576/107503337-2e14ed80-6bdd-11eb-85fd-ece731cc8f74.png)

í…ŒìŠ¤íŠ¸ê°€ ê¹¨ì ¸ìš©

í•˜ì§€ë§Œ í•´ê²° ë°©ë²•ì´ ìˆë‹¤.

```java
public <T> void putFavorite(Class<T> type, T instance) {
	favorites.put(Objects.requireNonNull(type), type.cast(instance));
}
```

`cast()`ë¥¼ ì¶”ê°€í•˜ë©´ ëœë‹¤.

![image](https://user-images.githubusercontent.com/42836576/107503340-2fdeb100-6bdd-11eb-9a45-66f571800f94.png)



2. ì‹¤ì²´í™” ë¶ˆê°€ íƒ€ì…ì—ëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤

```java
f.putFavorite(List<String>.class, testString); // ë¶ˆê°€ëŠ¥
```

- ì˜®ê¸´ì´ëŠ” ìŠˆí¼ íƒ€ì… í† í°ì„ ì‚¬ìš©í•œë‹¤ë©´ ëœë‹¤ê³  í•œë‹¤ (203p, ë” ì½ì„ ê±°ë¦¬ì— ì¶”ê°€)
- ì™„ë²½íˆ ë§Œì¡±ìŠ¤ëŸ¬ìš´ ìš°íšŒëŠ” ì—†ë‹¤.



## ê·¸ë˜ì„œ ì´ê±¸ ì–´ë””ì— ì‚¬ìš©í•˜ì§€?

- ë™ì ì´ë©° íƒ€ì… ì„¸ì´í”„í•œ ì»¨í…Œì´ë„ˆ ê°ì²´ê°€ í•„ìš”í•  ë•Œ
    - Collections.checkedMap
    - Collections.checkedList
    - Collections.checkedSet
- í˜¹ì‹œ í”„ë¡œì íŠ¸í•˜ë‹¤ê°€ ì ìš©í•´ë³´ì‹  ë¶„ ê³„ì‹ ê°€ìš” ... ?!?!



<br>



# ğŸ¥º ë” ì½ì„ ê±°ë¦¬

- [í† ë¹„ë‹˜ ë°©ì†¡ - ìˆ˜í¼ íƒ€ì… í† í° 1](https://www.youtube.com/watch?v=01sdXvZSjcI)
- [í† ë¹„ë‹˜ ë°©ì†¡ - ìˆ˜í¼ íƒ€ì… í† í° 2](https://www.youtube.com/watch?v=y_uGSqpE4So)