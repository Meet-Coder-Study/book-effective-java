# item 87. ì»¤ìŠ¤í…€ ì§ë ¬í™” í˜•íƒœë¥¼ ê³ ë ¤í•˜ë¼.

---

## ê°ì²´ì˜ ë¬¼ë¦¬ì  í‘œí˜„ê³¼ ë…¼ë¦¬ì  ë‚´ìš©ì´ ê°™ë‹¤ë©´ ê¸°ë³¸ ì§ë ¬í™” í˜•íƒœë¼ë„ ë¬´ë°©í•˜ë‹¤.

"ì´ìƒì ì¸ ì§ë ¬í™” ìƒíƒœ"

ë¬¼ë¦¬ì  í‘œí˜„ê³¼ ë…¼ë¦¬ì  ë‚´ìš©ì´ ê°™ì€ ìƒíƒœ

ë¬¼ë¦¬ì  í‘œí˜„ â†’ ì½”ë“œë¡œ ì–´ë–»ê²Œ êµ¬í˜„í–ˆëŠ”ì§€

ë…¼ë¦¬ì  ë‚´ìš© â†’ ì‹¤ì œë¡œ ì–´ë–¤ ê²ƒì„ ì˜ë¯¸í•˜ëŠ”ì§€

```java
public class Name implements Serializable {
    
    private final Stirng lastName;

    private final String firstName;

    private final String middleName;
}
```

## â­ ê°ì²´ì˜ ë¬¼ë¦¬ì  í‘œí˜„ê³¼ ë…¼ë¦¬ì  ë‚´ìš©ì´ ê°™ì€ ë‹¤ë¥¸ ê²½ìš° ë¬¸ì œì 

```java
public final class StringList implements Serializable {
    private int size = 0;
    private Entry head = null;

    private static class Entry implements Serializable {
        String data;
        Entry next;
        Entry previous;
    }
    // ... ìƒëµ
}
```

1. ê³µê°œAPIê°€ í˜„ì¬ì˜ ë‚´ë¶€ í‘œí˜„ ë°©ì‹ì— ì˜êµ¬íˆ ë¬¶ì¸ë‹¤.
    - ì˜ˆë¥¼ ë“¤ì–´, í–¥í›„ ë²„ì „ì—ì„œëŠ” ì—°ê²° ë¦¬ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê²Œ ë°”ê¾¸ë”ë¼ë„ ê´€ë ¨ ì²˜ë¦¬ëŠ” í•„ìš”í•´ì§„ë‹¤. ë”°ë¼ì„œ ì½”ë“œë¥¼ ì ˆëŒ€ ì œê±°í•  ìˆ˜ ì—†ë‹¤.
2. ë„ˆë¬´ ë§ì€ ê³µê°„ì„ ì°¨ì§€í•  ìˆ˜ ìˆë‹¤.
    - ìœ„ì˜ StringList í´ë˜ìŠ¤ë¥¼ ì˜ˆë¡œ ë“¤ë©´, ê¸°ë³¸ ì§ë ¬í™”ë¥¼ ì‚¬ìš©í•  ë•Œ ê° ë…¸ë“œì˜ ì—°ê²° ì •ë³´ê¹Œì§€ ëª¨ë‘ í¬í•¨ë  ê²ƒ
    - í•˜ì§€ë§Œ ì´ëŸ° ì •ë³´ëŠ” ë‚´ë¶€ êµ¬í˜„ì— í•´ë‹¹í•˜ê³ , ì§ë ¬í™” í˜•íƒœì— ê°€ì¹˜ê°€ ì—†ë‹¤. ë„¤íŠ¸ì›Œí¬ë¡œ ì „ì†¡í•˜ëŠ” ì†ë„ë§Œ ëŠë ¤ì§„ë‹¤.
3. ì‹œê°„ì´ ë„ˆë¬´ ë§ì´ ê±¸ë¦´ ìˆ˜ ìˆë‹¤.
    - ì§ë ¬í™” ë¡œì§ì€ ê°ì²´ ê·¸ë˜í”„ì˜ ìœ„ìƒì— ê´€í•œ ì •ë³´ë¥¼ ì•Œ ìˆ˜ ì—†ìœ¼ë‹ˆ, ì§ì ‘ ìˆœíšŒí•  ìˆ˜ë°–ì— ì—†ë‹¤.
4. ìŠ¤íƒ ì˜¤ë²„í”Œë¡œë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆë‹¤.
    - ê¸°ë³¸ ì§ë ¬í™” í˜•íƒœëŠ” ê°ì²´ ê·¸ë˜í”„ë¥¼ ì¬ê·€ ìˆœíšŒí•œë‹¤. í˜¸ì¶œ ì •ë„ê°€ ë§ì•„ì§€ë©´ ì´ë¥¼ ìœ„í•œ ìŠ¤íƒì´ ê°ë‹¹í•˜ì§€ ëª»í•  ê²ƒì´ë‹¤.

## í•©ë¦¬ì ì¸ ì§ë ¬í™” í˜•íƒœ

```java
public final class StringList implements Serializable {
    private transient int size = 0;// ì§ë ¬í™” ëŒ€ìƒì—ì„œ ì œì™¸í•œë‹¤.
    private transient Entry head = null;

    // ì´ë²ˆì—ëŠ” ì§ë ¬í™” í•˜ì§€ ì•ŠëŠ”ë‹¤.
    private static class Entry {
        String data;
        Entry next;
        Entry previous;
    }

    // ë¬¸ìì—´ì„ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€í•œë‹¤.
    public final void add(String s) { ... }

    /**
     * StringList ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì§ë ¬í™”í•œë‹¤.
     */
    private void writeObject(ObjectOutputStream stream)
            throws IOException {
        stream.defaultWriteObject();
        stream.writeInt(size);

        // ëª¨ë“  ì›ì†Œë¥¼ ìˆœì„œëŒ€ë¡œ ê¸°ë¡í•œë‹¤.
        for (Entry e = head; e != null; e = e.next) {
            s.writeObject(e.data);
        }
    }

    private void readObject(ObjectInputStream stream)
            throws IOException, ClassNotFoundException {
        stream.defaultReadObject();
        int numElements = stream.readInt();

        for (int i = 0; i < numElements; i++) {
            add((String) stream.readObject());
        }
    }
    // ... ìƒëµ
}
```

**transient**

í´ë˜ìŠ¤ì—ì„œ transient ë˜ëŠ” static í‚¤ì›Œë“œê°€ ì„ ì–¸ëœ í•„ë“œë¥¼ ì œì™¸í•˜ê³ ëŠ” ëª¨ë‘ ì§ë ¬í™” ëŒ€ìƒì´ ëœë‹¤.

transient í‚¤ì›Œë“œê°€ ì„ ì–¸ëœ ë©¤ë²„ ë³€ìˆ˜ëŠ” ì§ë ¬í™” ëŒ€ìƒì— ì œì™¸ë˜ì—ˆê¸° ë•Œë¬¸ì— ìë°” ê°ì²´ë¡œ ë³€í™˜ë˜ëŠ” ì—­ì§ë ¬í™” ê²°ê³¼ì—ì„œë„ ê°’ì„ í™•ì¸í•  ìˆ˜ ì—†ë‹¤.

ğŸ¤·â€â™€ï¸

**writeObject ì™€ readObject ê°€ private ìœ¼ë¡œ ê¸°ìˆ ë˜ì–´ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì— ì£¼ëª©**í•´ë³¼ë§Œ í•˜ë‹¤.

ë‹¤ë¥¸ ì ‘ê·¼ ì§€ì •ìë¡œ ì„ ì–¸ëœ ê²½ìš° í˜¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤.Â `private`Â ìœ¼ë¡œ ì„ ì–¸ë˜ì—ˆë‹¤ëŠ” ê²ƒì€ ì´ í´ë˜ìŠ¤ë¥¼ ìƒì†í•œ ì„œë¸Œ í´ë˜ìŠ¤ì—ì„œ ë©”ì„œë“œë¥¼Â **ì¬ì •ì˜(override)**ë¥¼ í•˜ì§€ ëª»í•˜ê²Œ í•œë‹¤ëŠ” ê²ƒì´ë‹¤.

ë˜í•œ ë‹¤ë¥¸ ê°ì²´ëŠ” í˜¸ì¶œí•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— í´ë˜ìŠ¤ì˜ ë¬´ê²°ì„±ì´ ìœ ì§€ë˜ë©° ìˆ˜í¼ í´ë˜ìŠ¤ì™€ ì„œë¸Œ í´ë˜ìŠ¤ëŠ” ë…ë¦½ì ìœ¼ë¡œ ì§ë ¬í™” ë°©ì‹ì„ ìœ ì§€í•˜ë©° í™•ì¥ë  ìˆ˜ ìˆë‹¤. ì§ë ¬í™” ê³¼ì •ì—ì„œëŠ”Â **ë¦¬í”Œë ‰ì…˜(reflection)**ì„ í†µí•´ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ê¸° ë•Œë¬¸ì— ì ‘ê·¼ ì§€ì •ìëŠ” ë¬¸ì œê°€ ë˜ì§€ ì•ŠëŠ”ë‹¤. 

defaultWriteObject() ì™€ defaultReadObject() ëŠ” ê°ê° ê¸°ë³¸ serialization ì„ ìˆ˜í–‰í•œë‹¤.

ë”°ë¼ì„œ custom serialization ì˜ ì „í›„ì— ë°˜ë“œì‹œ í˜¸ì¶œí•´ì¤˜ì•¼ í•œë‹¤.

```java
public class SomeClass implements Serializable {
    private String fld1;
    private int fld2;
    private transient String fld3; 
    private void readObject(java.io.ObjectInputStream stream)
         throws IOException, ClassNotFoundException {
         stream.defaultReadObject(); //fills fld1 and fld2;
         fld3 = Configuration.getFooConfigValue();
    }
]
```

ì´ë ‡ê²Œ í•´ì•¼ í–¥í›„ ë¦´ë¦¬ì¦ˆì—ì„œ transientê°€ ì•„ë‹Œ í•„ë“œê°€ ì¶”ê°€ë˜ë”ë¼ë„ ìƒìœ„ì™€ í•˜ìœ„ ëª¨ë‘ í˜¸í™˜ì´ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

## SerialVersionUID

```java
// ë¬´ì‘ìœ„ë¡œ ê³ ë¥¸ long ê°’
private static final long serialVersionUID = 0204L;
```

ì§ë ¬í™”ë¥¼ í•  ë•Œ SUID ì„ ì–¸ì´ ì—†ë‹¤ë©´ ë‚´ë¶€ì—ì„œ ìë™ìœ¼ë¡œ ìœ ë‹ˆí¬í•œ ë²ˆí˜¸ë¥¼ ìƒì„±í•˜ì—¬ ê´€ë¦¬í•˜ê²Œ ëœë‹¤. 

SUIDëŠ” ì§ë ¬í™”ì™€ ì—­ì§ë ¬í™” ê³¼ì •ì—ì„œ ê°’ì´ ì„œë¡œ ë§ëŠ”ì§€ í™•ì¸í•œ í›„ì— ì²˜ë¦¬ë¥¼ í•˜ê¸° ë•Œë¬¸ì— ì´ ê°’ì´ ë§ì§€ ì•Šë‹¤ë©´ Â `InvalidClassException`Â ì˜ˆì™¸ê°€ ë°œìƒí•œë‹¤.

ìë°”ì˜ ì§ë ¬í™” ìŠ¤í™ ì •ì˜ë¥¼ ì‚´í´ë³´ë©´ SUID ê°’ì€ í•„ìˆ˜ê°€ ì•„ë‹ˆë©° ì„ ì–¸ë˜ì–´ ìˆì§€ ì•Šìœ¼ë©´ í´ë˜ìŠ¤ì˜ ê¸°ë³¸ í•´ì‹œê°’ì„ ì‚¬ìš©í•œë‹¤.

- [ì°¸ê³  ë§í¬: Oracle Docs(ë§í¬)](https://docs.oracle.com/javase/10/docs/specs/serialization/class.html)

ë”°ë¼ì„œÂ **ì§ì ‘ SUIDë¥¼ ëª…ì‹œí•˜ì§€ ì•Šë”ë¼ë„ ë‚´ë¶€ì—ì„œ ìë™ìœ¼ë¡œ ê°’ì´ ì¶”ê°€**ë˜ë©° ì´ ê°’ë“¤ì€ í´ë˜ìŠ¤ì˜ ì´ë¦„, ìƒì„±ì ë“±ê³¼ ê°™ì´ í´ë˜ìŠ¤ì˜ êµ¬ì¡°ë¥¼ ì´ìš©í•´ì„œ ìƒì„±í•œë‹¤

ì§ë ¬í™” ê°€ëŠ¥í•œ í´ë˜ìŠ¤(Article)ë¥¼ ì„ ì–¸í•  ë•Œ SUID ê°’ì„ ìƒëµí•´ë„ ë‚´ë¶€ì ìœ¼ë¡œ ì •ë³´ê°€ ìƒì„±ë˜ì–´ ìˆìŒì„ ìœ ì¶”í•  ìˆ˜ ìˆë‹¤.

### ğŸ’¡ëª…ì‹œì ìœ¼ë¡œ ì„ ì–¸í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•œë‹¤!

- ëŸ°íƒ€ì„ì— ë§ì€ ì‹œê°„ì´ ì†Œìš”ëœë‹¤.
- ê¼­ ìœ ë‹ˆí¬í•  í•„ìš”ëŠ” ì—†ì§€ë§Œ ì´ì „ ë²„ì „ í´ë˜ìŠ¤ì™€ì˜ í˜¸í™˜ì„ ìœ„í•´ ê°’ì„ ë³€ê²½í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ì¢‹ë‹¤.

ê°œë°œì„ í•˜ë‹¤ ë³´ë©´, ì¢…ì¢… ë‹¤ìŒ ë¦´ë¦¬ì¦ˆì—ì„œ ì œëŒ€ë¡œ êµ¬í˜„í•˜ê¸°ë¡œ í•˜ê³  ì´ë²ˆ ë¦´ë¦¬ì¦ˆì—ì„œëŠ” ë™ì‘ë§Œ í•˜ë„ë¡ í•˜ëŠ” ê²½ìš° ë°œìƒ

ê·¼ë° ì´ê±¸ Serializableì„ êµ¬í˜„í•˜ê³  ê¸°ë³¸ ì§ë ¬í™” í˜•íƒœë¥¼ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒ ë¦´ë¦¬ì¦ˆ ë•Œ ë°œì´ ë¬¶ì„

ë¨¼ì € ê³ ë¯¼í•´ë³´ê³  ê´œì°®ë‹¤ê³  íŒë‹¨ë  ë•Œë§Œ ê¸°ë³¸ ì§ë ¬í™” í˜•íƒœë¥¼ ì‚¬ìš©í•˜ë¼

---

## ì°¸ê³ 

<ìˆœí™˜ì°¸ì¡°ê°€ ê±¸ë ¤ìˆëŠ” ê°ì²´ì˜ ê²½ìš° ì§ë ¬í™”ë¥¼ í•˜ë©´>

[Does Java Serialization work for cyclic references?](https://stackoverflow.com/questions/1792501/does-java-serialization-work-for-cyclic-references)

javaì˜ ê¸°ë³¸ ì§ë ¬í™” êµ¬ì¡°ëŠ” ìˆœí™˜ ì°¸ì¡°ê°€ ìˆëŠ” í´ë˜ìŠ¤ì—ì„œ ì´ë¯¸ ì§ë ¬í™” ë˜ì–´ìˆëŠ” í´ë˜ìŠ¤ë¼ë©´ ì§ë ¬í™” í•˜ì§€ì•ŠëŠ”ë‹¤!

```java
import java.io.*;
class A implements Serializable { B b; }
class B implements Serializable { C c; }
class C implements Serializable { A a; }
public class Test {
    public static void main( String [] args ) throws IOException, ClassNotFoundException {
        A a = new A();
        a.b = new B();
        a.b.c = new C();
        a.b.c.a = a;

        ByteArrayOutputStream byteStream = new ByteArrayOutputStream();
        ObjectOutputStream outputStream = new ObjectOutputStream(byteStream);
        outputStream.writeObject(a);

        ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(byteStream.toByteArray());
        ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream);

        A deserialzedA = (A) objectInputStream.readObject();

    }
}
```
